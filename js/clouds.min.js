(function(e){function s(e,t,n){switch(e){case"linear-random":return parseInt((t/2+Math.random()*t/2)*i/n);case"linear":return parseInt(t*i/n);case"exp":return parseInt(3*t*Math.pow(i/n,2))}}function o(e,t,n,i){var o=e[0].width,u=e[0].height;this.$obj=e,this.permutate=function(){var a=Math.floor(Math.random()*r.length),f=i||r[a],l=s("exp",o,f),c=s("exp",u,f);return this.dx=s("linear-random",t,f),e.css("width",l+"px").css("height",c+"px").css("z-index",n-a),this}}function u(r){function m(e,t,n,r){var i=e.clone(),s=e.css("z-index");return i.attr("id",null).addClass(t).removeClass("hidden").hide(),(new o(i,n,s,r)).permutate().position({x:Math.random()*(p-i.width()),y:Math.random()*(v-i.height())})}var i=r.fps,s=r.cloudsTotal||5,u=r.planeFlybyChance||.5,a=-Math.abs(r.cloudVelocity||-150)/i,f=-Math.abs(r.planeVelocity||-150)/i,l=$("#cloud"),c=$("#plane"),h=$("#sky"),p=$(window).width(),d=$(window).height(),v=Math.min($("#water-bg").offset().top,$("#water-fg").offset().top);n.plane=m(c,"plane",f,500);for(var g=0;g<s;g++)n["cloud"+g]=m(l,"cloud",a);for(var y in n)h.append(n[y].$obj);loop=e.repeater({delay:1/i},function(){$.each(n,function(e,t){var n=t.position(),r=t.$obj;n.x<=0?r.fadeOut("short",function(){t.permutate().position({x:p-r.width(),y:Math.random()*(v-r.height())});switch(e){case"plane":Math.random()<=u?r.fadeIn("short"):r.hide();break;default:r.fadeIn("short")}}):t.position({x:n.x+t.dx})})}),loop.start(),t.events.emit("loaded.clouds")}var t=e.game,n={},r=[250,400,550],i=250;o.prototype.position=function(e){if(!e){var t=this.$obj.offset();return{x:t.left,y:t.top}}return e.x!=undefined&&this.$obj.css("left",parseInt(e.x)+"px"),e.y!=undefined&&this.$obj.css("top",parseInt(e.y)+"px"),this},t.events.on("loaded.core",function(e){function s(){i+=1,i==2&&u(t)}var t=e.settings,n=$("#cloud"),r=$("#plane"),i=0;n[0].complete&&s(),r[0].complete&&s(),n.on("load",s),r.on("load",s)})})(this)
