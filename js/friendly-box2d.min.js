(function(a){var b=a.Common.Math.b2Vec2,c=a.Collision.b2AABB,d=a.Dynamics.b2BodyDef,e=a.Dynamics.b2Body,f=a.Dynamics.b2FixtureDef,g=a.Dynamics.b2Fixture,h=a.Dynamics.b2World,i=a.Collision.Shapes.b2MassData,j=a.Collision.Shapes.b2PolygonShape,k=a.Collision.Shapes.b2CircleShape;ContactListener=a.Dynamics.b2ContactListener;function l(a,b,c){var d=[];for(var e in a)if(a.hasOwnProperty(e))d.push(b(e,a[e],c));return d;}function m(a,b){l(a,function(c,d){if(a.hasOwnProperty(c)&&!(c in b))b[c]=a[c];});return b;};function n(c){var g,i=[];m({ignoreStatic:true,drawRatio:1,gravity:{x:0,y:9.8}},c);this.drawRatio=function(){return c.drawRatio;};this.world=function(){return g;};this.step=function(){return g.Step.apply(g,arguments);};this.clearForces=function(){return g.ClearForces.apply(g,arguments);};this.iterBodies=function(a,b){return l(i,a,b);};this.addBody=function(a){if(arguments.length===0)throw new TypeError();m({'shape':'box','static':true,'density':1.0,'friction':0.5,'restitution':0.3,'sensorCallback':undefined,'x':0,'y':0,'rotation':0,'radius':undefined,'width':undefined,'height':undefined,'vertices':undefined,'id':undefined},a);a=m(a,{'x':this.parsePixels(a.x),'y':this.parsePixels(a.y),'radius':this.parsePixels(a.radius),'width':this.parsePixels(a.width),'height':this.parsePixels(a.height)});if(a.vertices)a.shape='polygon';var c=new f(),h=new d();c.density=a.density;c.friction=a.friction;c.restitution=a.restitution;h.type=a.static?e.b2_staticBody:e.b2_dynamicBody;h.position.Set(a.x,a.y);switch(a.shape){case 'box':c.shape=new j();c.shape.SetAsBox(a.width/2,a.height/2);break;case 'polygon':var n=this;var o=l(a.vertices,function(a,c){return new b(n.parsePixels(c[0]),n.parsePixels(c[1]));});c.shape=new j();c.shape.SetAsArray(o,o.length);break;case 'circle':c.shape=new k(a.radius);break;default:throw new TypeError();}var p=g.CreateBody(h),q=p.CreateFixture(c);if(typeof a.sensorCallback==='function')p.sensorCallback=a.sensorCallback;p.SetAngle(a.rotation);p.id=a.id;i.push(p);return p;};g=new h(new b(c.gravity.x,c.gravity.y),c.ignoreStatic);var n=new a.Dynamics.b2ContactListener();n.BeginContact=function(a){if(typeof a.m_fixtureA.m_body.sensorCallback==='function')a.m_fixtureA.m_body.sensorCallback.call(null,a,a.m_fixtureA.m_body,a.m_fixtureB.m_body);if(typeof a.m_fixtureB.m_body.sensorCallback==='function')a.m_fixtureB.m_body.sensorCallback.call(null,a,a.m_fixtureB.m_body,a.m_fixtureA.m_body);};g.SetContactListener(n);};n.prototype.gravity=function(a){var c=this.world().GetGravity();if(!a)return c;else this.world.SetGravity(new b(a.x==undefined?c.x:a.x,a.y==undefined?c.y:a.y));};n.prototype.parsePixels=function(a){var b=this.drawRatio();if(typeof a=='string')return parseFloat(a.replace(/^\s*([-0-9.]+)\s*px/im,function(a,c){return parseFloat(c)*1/b;}));else return a;};n.prototype.toPixels=function(a){return a*this.drawRatio();};n.prototype.toMeters=function(a){if(typeof a=='string')a=a.replace(/px/i,'');return a/this.drawRatio();};n.prototype.randomImpulse=function(a,c){m({minAngle:0,maxAngle:360,scale:'10px'},c);c.scale=this.parsePixels(c.scale);var d=c.minAngle+Math.random()*(c.maxAngle-c.minAngle);var e=a.GetWorldCenter();var f=new b(Math.cos(d*Math.PI/180)*c.scale,Math.sin(d*Math.PI/180)*c.scale);a.ApplyImpulse(f,e);};a.world=n;})(Box2D);