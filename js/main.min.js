Box2D.impulse=function(a,b,c){c=(c==undefined)?0.001:c;a.ApplyImpulse({x:-Math.cos(b)*c,y:Math.sin(b)*c},a.GetWorldCenter());};var beachball={};(function(a){var b=a.repeater=function(a,b){if(!a)throw new Error();if(!a.delay||a.delay<0)throw new Error('delay must be >= 0');var c,d=a.delay,e=function(b){if(typeof a.runningHook==='function')a.runningHook(b);};return{start:function(){if(c==undefined){c=setInterval(b,1000*d);e(true);}},stop:function(){if(c!=undefined){clearInterval(c);c=undefined;e(false);}},step:b,running:function(){return c!=undefined;}};};var c={impulseMagnitude:0.0001,targetFPS:30,stepSize:4,defaultGravity:{x:0,y:9.8},difficulty:{'easy':0.5,'medium':1.0,'hard':1.25}};var d,e;var f,g=[],h=[],i=false,j=false,k=1,l='hard';var m={},n=$(m);var o=function(a,b,c){var d;if(b.id=='#beachball')d=b;else if(c.id=='#beachball')d=c;if(d)n.triggerHandler({type:'game.wallHit',body:d});};var p=b({delay:1/c.targetFPS},function(){f.step(1/c.targetFPS,c.stepSize,c.stepSize);f.iterBodies(function(a,b){if(b.id!=undefined){var c=b.GetPosition(),d=b.GetAngle(),e=f.drawRatio(),g=$(b.id);g.css('left',c.x*e-g.width()/2+'px');g.css('top',c.y*e-g.height()/2+'px');g.rotate(d,'rad');}});f.clearForces();});var q=b({delay:1/100},function(){var a=0,b=0;for(var d in g)a+=g[d];for(var d in h)b+=h[d];a/=g.length;b/=h.length;g=[];h=[];a*=k;b*=k;if(!isNaN(a)&&!isNaN(b)){f.gravity({x:a,y:-b});var i=Math.atan(b/(a+0.00001));e.ApplyImpulse({x:-Math.cos(i)*c.impulseMagnitude,y:Math.sin(i)*c.impulseMagnitude},e.GetWorldCenter());}});m.difficulty=function(){if(arguments[0]&&arguments[0] in c.difficulty){l=arguments[0];k=c.difficulty[arguments[0]];}else return l;};m.drawRatio=function(){return f.drawRatio();};m.started=function(){return i;};m.paused=function(){return j;};m.load=function(){var a=$(window),b=a.width(),i=a.height(),j=$('#beachball'),k=$('#safe-zone'),l=$('#danger-zone');d={x:b/2+'px',y:'100px'};f=new Box2D.world({drawRatio:a.width(),gravity:c.defaultGravity});k.css('left',b/2-k.width()/2+'px');l.css('left',b/2-l.width()/2+'px');j.css('left',d.x).css('top',d.y);var p=10;e=f.addBody({shape:'circle',static:false,radius:j.width()/2+'px',x:d.x,y:d.y,id:'#beachball'});f.addBody({static:true,sensorCallback:o,x:b/2+'px',y:i+j.height()*2+p+'px',width:b*4+'px',height:p+'px'});f.addBody({static:true,sensorCallback:o,x:-b+'px',y:i/2+'px',width:p+'px',height:i*4+'px'});f.addBody({static:true,sensorCallback:o,x:b*2+'px',y:i/2+'px',width:p+'px',height:i*4+'px'});f.addBody({static:true,sensorCallback:o,x:b/2+'px',y:-j.height()*2+'px',width:b*4+'px',height:p+'px'});f.addBody({shape:'box',x:b/2+'px',y:l.offset().top+l.height()+'px',width:l.width()-l.cornerRadius()*2+'px',height:l.height()*2+'px'});f.addBody({shape:'circle',x:l.offset().left+l.cornerRadius()+'px',y:l.offset().top+l.height()/2+'px',radius:l.cornerRadius()+'px'});f.addBody({shape:'circle',x:l.offset().left+l.width()-l.cornerRadius()+'px',y:l.offset().top+l.height()/2+'px',radius:l.cornerRadius()+'px'});n.on('game.unloaded game.pause',q.stop);n.on('game.start game.unpause',q.start);var r;a.on('devicemotion.game',function(a){a=a.originalEvent;switch(window.orientation){case 90:g.push(-a.accelerationIncludingGravity.y);h.push(a.accelerationIncludingGravity.x);break;case -90:g.push(a.accelerationIncludingGravity.y);h.push(-a.accelerationIncludingGravity.x);break;default:g.push(a.accelerationIncludingGravity.x);h.push(a.accelerationIncludingGravity.y);break;}});if(window.orientation!=undefined){r=window.orientation;$(window).on('orientationchange.game',function(){if(window.orientation!=r)if(!m.paused()){r=window.orientation;m.reload();}else n.triggerHandler({type:'game.pause',reason:'orientation changed and the game will reset!<br/><h3>rotate back to unpause</h3>'});});n.on('game.unpause.orientationchange',function(){if(window.orientation!=r)m.reload();});}n.on('game.pushLeft',function(){var a=f.gravity(),b=Math.atan(-a.x/(a.y+0.00001));Box2D.impulse(e,0);});n.on('game.pushRight',function(){var a=f.gravity(),b=Math.atan(a.x/(a.y+0.00001));Box2D.impulse(e,360);});n.triggerHandler('game.startPhysics');n.triggerHandler('game.loaded');};m.unload=function(a){i=false;j=false;p.stop();n.off('game.unpause.orientationchange game.pushRight game.pushLeft game.reset game.unloaded game.pause');$(window).off('devicemotion.game orientationchange.game');n.triggerHandler('game.unloaded');};m.reload=function(){i=false;j=false;p.stop();n.off('game.unpause.orientationchange game.pushRight game.pushLeft game.reset game.unloaded game.pause');$(window).off('devicemotion.game orientationchange.game');$.when(n.triggerHandler('game.unloaded')).done(m.load);};n.on('game.pause',function(){j=true;p.stop();});n.on('game.startPhysics',function(){p.start();i=true;j=false;});n.on('game.unpause game.start',function(){if(!i){e.SetAngularVelocity(0);e.SetLinearVelocity({x:0,y:0});e.SetPositionAndAngle({x:f.toMeters(d.x),y:f.toMeters(d.y)},0);Box2D.impulse(e,Math.random()*360,0.002);p.start();i=true;j=false;}});n.on('game.reset',function(){i=false;j=false;p.stop();});a.game=m;a.settings=c;})(beachball);(function(a){var b={numClouds:4,targetFPS:30,scaleMin:0.2,scaleMax:1.5,parallaxMin:1,parallaxScale:10,parallaxPower:2,planeFlybyChance:0.4,cloudNode:$('#cloud'),planeNode:$('#plane'),containerNode:$('#sea')};var c=$(window),d=[];var e=function(a){return parseFloat(a.replace(/px/i,''));};var f=a.repeater({delay:1/b.targetFPS},function(){$.each(d,function(a,d){var f=d.image,g=f.width(),h=f.height(),i=e(f.css('left'));if(i<=0)f.fadeOut('short',function(){f.css('left',parseInt(c.width())+'px');f.css('top',parseInt(Math.random()*(c.height()-h))+'px');if(d.plane)if(Math.random()<=b.planeFlybyChance)f.fadeIn('short');else f.hide();else f.fadeIn('short');});else f.css('left',parseInt(i-d.dx)+'px');});});var g=function(){};var h=function(){for(var a=0;a<b.numClouds+1;a++){var e={},g=(b.scaleMin+(Math.random()*b.scaleMax));if(a==0){node=b.planeNode.clone();e.plane=true;}else node=b.cloudNode.clone();e.image=node;e.image.attr('id',null);e.image.addClass('cloud');b.containerNode.append(e.image);var h=node[0].width;height=node[0].height;e.image.css('width',parseInt(h*g)+'px');e.image.css('height',parseInt(height*g)+'px');e.dx=Math.pow((b.parallaxMin+((g-b.scaleMin)/b.scaleMax)*b.parallaxScale),b.parallaxPower)/b.targetFPS;e.image.css('left',parseInt(Math.random()*(c.width()-e.image.width()))+'px');e.image.css('top',parseInt(Math.random()*(c.height()-e.image.height()))+'px');if(a==0)e.image.hide();d.push(e);}f.start();};g.load=function(){if(!b.cloudNode[0].complete)b.cloudNode.on('load',h);else h();};g.unload=function(){f.stop();b.containerNode.children().remove();d=[];b.cloudNode.off('load.game');};a.clouds=g;})(beachball);(function(a){$(document).ready(function(){var b='KiSS 92.5 beachball madness!';var c=a.game,d=$(c),e=0,f=50,g=$('#counter');var h=false,i=function(a){if(a!=undefined)h=a;else return h;};var j=a.repeater({delay:1/f,runningHook:i},function(){g.text(e.toFixed(2));e+=1/f;});d.on('game.reset game.unloaded',function(a){j.stop();g.html(a.reason||b);e=0;$('.start').fadeIn();});d.on('game.start game.unpause',function(){if(!i()){j.start();j.step();$('.pause-unpause').fadeOut();}});d.on('game.pause',function(a){if(i()){j.stop();$('.pause-unpause').attr('value','unpause').fadeIn();if(a.reason)$('#counter').html(a.reason);}});d.on('game.notLoaded',function(a){$('#counter').html(a.reason);$('.start').fadeOut();});d.on('game.wallHit',function(a){if(i()){i(false);var b=c.drawRatio(),f=$(window),g=f.width(),h=a.body.GetPosition();var j=((h.x*b)<g/2)?0:g-$('#splash').width();d.triggerHandler({type:'game.reset',reason:e.toFixed(2)+'<h3>final time</h3>'});$('#splash').css('bottom','0px').css('left',j+'px').show(100,function(){$(this).fadeOut(800);});}});d.on('game.unloaded',function(){i(false);$('#counter').html(b);$('.start').off('click.game').fadeOut();$('.pause-unpause').off('click.game').fadeOut();});d.on('game.loaded',function(){i(false);$('#counter').html(b);$('.start').on('click.game',function(){if(!i()){$('.start').fadeOut();d.triggerHandler('game.start');}}).fadeIn();$('.pause-unpause').on('click.game',function(){if(i()){$(this).fadeIn();d.triggerHandler('game.pause');}else{$(this).fadeOut();d.triggerHandler('game.unpause');}});});$(window).on('keydown',function(a){switch(String.fromCharCode(a.keyCode)){case 'a':case 'A':if(i())d.triggerHandler('game.pushLeft');break;case 'd':case 'D':if(i())d.triggerHandler('game.pushRight');break;case 's':case 'S':if(!i()){$('.start').fadeOut();d.triggerHandler('game.start');}break;}});a.clouds.load();c.load();});})(beachball);