var app={};(function(a){var b={impulseMagnitude:0.0001,targetFPS:30,stepSize:4,beachHeight:50,gravityScale:1,defaultGravity:{x:0,y:9.8}};var c,d,e=[],f=[],g,h=false,i=false;var j;var k=function(){};var l=function(a,b,c){var d;if(b.id=='#beachball')d=b;else if(c.id=='#beachball')d=c;if(d)$(k).triggerHandler({type:'game.wallHit',body:d});};var m=function(){l.apply(null,arguments);};var n=function(){c.world.Step(1/b.targetFPS,b.stepSize,b.stepSize);$.each(c.bodies,function(a,b){if(b.id!=undefined){var d=b.GetPosition(),e=$(b.id);e.css('left',d.x*c.drawScale-e.width()/2+'px');e.css('top',d.y*c.drawScale+'px');e.rotate(b.GetAngle(),'rad');}});c.world.ClearForces();};var o=function(){var a=0,g=0;for(var h in e)a+=e[h];for(var h in f)g+=f[h];a/=e.length;g/=f.length;e=[];f=[];a*=b.gravityScale;g*=b.gravityScale;if(!isNaN(a)&&!isNaN(g)){c.gravity({x:a,y:-g});var i=Math.atan(g/(a+0.00001));d.beachball.ApplyImpulse({x:-Math.cos(i)*b.impulseMagnitude,y:Math.sin(i)*b.impulseMagnitude},d.beachball.GetWorldCenter());}};k.difficulty=function(){if(arguments[0]){var a;switch(arguments[0]){case 'easy':a=0.5;break;case 'medium':a=0.75;break;case 'hard':a=1.0;break;}b.gravityScale=a;b.difficulty=arguments[0];}else return b.difficulty;};k.drawScale=function(){return c.drawScale;};k.started=function(){return h;};k.paused=function(){return i;};k.load=function(){var a=$(window),g=$('#beachball'),h=$('#safe-zone'),i=$('#danger-zone');j={x:a.width()/2+'px',y:'100px'};c=box2dw.world({drawScale:a.width(),gravity:b.defaultGravity});h.css('left',a.width()/2-h.width()/2+'px').css('top',a.height()-b.beachHeight+'px');i.css('left',a.width()/2-i.width()/2+'px').css('top',a.height()-b.beachHeight+'px');g.css('left',a.width()/2-g.width()/2+'px');var n=i.cornerRadius(),p=i.width()-n*2;var q=10;d={bottomWall:c.body({static:true,sensorCallback:l,x:a.width()/2+'px',y:a.height()+g.height()+q+'px',width:a.width()*4+'px',height:q+'px'}),leftWall:c.body({static:true,sensorCallback:m,x:-a.width()+'px',y:a.height()/2+'px',width:q+'px',height:a.height()*4+'px'}),rightWall:c.body({static:true,sensorCallback:m,x:a.width()*2+'px',y:a.height()/2+'px',width:q+'px',height:a.height()*4+'px'}),topWall:c.body({static:true,sensorCallback:m,x:a.width()/2+'px',y:-g.height()*2+'px',width:a.width()*4+'px',height:q+'px'}),beachCenter:c.body({shape:'box',x:a.width()/2+'px',y:a.height()-b.beachHeight+n+'px',width:p+'px',height:n*2+'px'}),beachCapRight:c.body({shape:'circle',x:a.width()/2+p/2+'px',y:a.height()-b.beachHeight+n+'px',radius:n+'px'}),beachCapLeft:c.body({shape:'circle',x:a.width()/2-p/2+'px',y:a.height()-b.beachHeight+n+'px',radius:n+'px'}),beachball:c.body({shape:'circle',static:false,radius:g.width()+'px',x:j.x,y:j.y,id:'#beachball'})};var r,s=100,t;if(window.DeviceMotionEvent==undefined)return $(k).triggerHandler({type:'game.notLoaded',reason:'device gravity not supported in your browser'});$(window).on('devicemotion.game',function(a){a=a.originalEvent;switch(window.orientation){case 90:e.push(-a.accelerationIncludingGravity.y);f.push(a.accelerationIncludingGravity.x);break;case -90:e.push(a.accelerationIncludingGravity.y);f.push(-a.accelerationIncludingGravity.x);break;default:e.push(a.accelerationIncludingGravity.x);f.push(a.accelerationIncludingGravity.y);break;}});$(k).on('game.reset game.unloaded game.pause',function(a){if(r!=undefined)clearInterval(r);;});$(k).on('game.start game.unpause',function(a){r=setInterval(o,s);});if(window.orientation!=undefined){t=window.orientation;$(window).on('orientationchange.game',function(){if(window.orientation!=t)if(!k.paused()){t=window.orientation;k.reload();}else $(k).triggerHandler({type:'game.pause',reason:'orientation changed and the game will reset!<br/><h3>rotate back to unpause</h3>'});});$(k).on('game.unpause.orientationchange',function(){if(window.orientation!=t)k.reload();});}$(k).triggerHandler('game.startPhysics');$(k).triggerHandler('game.loaded');};k.unload=function(a){h=false;i=false;$(k).off('game.unpause.orientationchange');$(window).off('devicemotion.game orientationchange.game');if(g!=undefined)clearInterval(g);$.when($(k).triggerHandler('game.unloaded')).done(function(){c=undefined;if(typeof a==='function')a();});};k.reload=function(){k.unload(k.load);};$(k).on('game.pause',function(){i=true;if(g!=undefined)clearInterval(g);});$(k).on('game.unpause game.startPhysics game.start',function(){if(!h){g=setInterval(n,1000/b.targetFPS);h=true;i=false;}});$(k).on('game.reset',function(a){h=false;i=false;if(g!=undefined)clearInterval(g);d.beachball.SetAngularVelocity(0);d.beachball.SetLinearVelocity({x:0,y:0});d.beachball.SetPositionAndAngle({x:c.toMeters(j.x),y:c.toMeters(j.y)},0);});a.game=k;a.settings=b;})(app);(function(a){var b={numClouds:4,targetFPS:30,scaleMin:0.5,scaleMax:1.5,parallaxMin:1,parallaxScale:10,parallaxPower:2,cloudNode:$('#cloud'),containerNode:$('#sea')};var c=undefined,d=$(window),e=[];var f=function(a){return parseFloat(a.replace(/px/i,''));};var g=function(){$.each(e,function(a,b){var c=b.image,e=c.width(),g=c.height(),h=f(c.css('left'));if(h<=0)c.fadeOut('short',function(){c.css('left',parseInt(d.width())+'px');c.css('top',parseInt(Math.random()*(d.height-g))+'px');c.fadeIn('short');});else c.css('left',parseInt(h-b.dx)+'px');});};var h=function(){};var i=function(){for(var a=0;a<b.numClouds;a++){var f={},h=(b.scaleMin+(Math.random()*b.scaleMax));f.image=b.cloudNode.clone();f.image.attr('id',null);f.image.css('position','fixed');f.image.css('width',b.cloudNode[0].width*h+'px');f.image.css('height',b.cloudNode[0].height*h+'px');f.dx=Math.pow((b.parallaxMin+((h-b.scaleMin)/b.scaleMax)*b.parallaxScale),b.parallaxPower)/b.targetFPS;f.image.css('left',parseInt(Math.random()*(d.width()-f.image.width()))+'px');f.image.css('top',parseInt(Math.random()*(d.height()-f.image.height()))+'px');b.containerNode.append(f.image);e.push(f);}c=setInterval(g,1000/b.targetFPS);};h.load=function(){if(!b.cloudNode[0].complete)b.cloudNode.on('load',i);else i();};h.unload=function(){if(c!=undefined)clearInterval(c);b.containerNode.children().remove();e=[];b.cloudNode.off('load.game');};a.clouds=h;})(app);(function(a){$(document).ready(function(){var b='beachball madness!';var c=a.game,d,e=0,f=50,g=false,h=$('#counter');var i=function(){h.text(e.toFixed(2));e+=1/f;};$(c).on('game.reset game.unloaded',function(a){if(d!=undefined)clearInterval(d);;h.html(a.reason||b);e=0;$('.start').fadeIn();});$(c).on('game.start game.unpause',function(){if(!g){d=setInterval(i,f);i();$('.pause-unpause').fadeOut();g=true;}});$(c).on('game.pause',function(a){if(g){if(d!=undefined)clearInterval(d);;$('.pause-unpause').attr('value','unpause').fadeIn();if(a.reason)$('#counter').html(a.reason);g=false;}});$(c).on('game.notLoaded',function(a){$('#counter').html(a.reason);$('.start').fadeOut();});$(c).on('game.wallHit',function(a){if(g){g=false;var b=c.drawScale(),d=$(window);var f=((a.body.GetPosition().x*b)<d.width()/2)?0:d.width()-$('#splash').width();$('#splash').css('bottom','0px').css('left',f+'px').show(100,function(){$(this).fadeOut(800,function(){var a=e.toFixed(2);$(c).triggerHandler({type:'game.reset',reason:a+'<h3>final time</h3>'});});});}});$(c).on('game.unloaded',function(){g=false;$('#counter').html(b);$('.start').off('click.game').fadeOut();$('.pause-unpause').off('click.game').fadeOut();});$(c).on('game.loaded',function(){g=false;$('#counter').html(b);$('.start').on('click.game',function(){if(!g){stated=true;$('.start').fadeOut();$(c).triggerHandler('game.start');}}).fadeIn();$('.pause-unpause').on('click.game',function(){if(g){$(this).fadeIn();$(c).triggerHandler('game.pause');}else{$(this).fadeOut();$(c).triggerHandler('game.unpause');}});});var j=false;$('#clouds-toggle').on('click.game',function(){if(j){$(this).attr('value','clouds');a.clouds.unload();}else{$(this).attr('value','no clouds');a.clouds.load();}j=!j;}).click();var k=1,l=['easy','medium','hard'];$('#difficulty-toggle').on('click.game',function(){k=(k+1)%l.length;c.difficulty(l[k]);$(this).attr('value',l[k]);}).click();c.load();});})(app);